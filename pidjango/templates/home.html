<!DOCTYPE html>
<html>

<head>
    {% load static %}
    <link rel="stylesheet" href="{% static 'home.css' %}">
</head>

<body>
    <div class="flex-container">
        <div id="logo">
            <span class="speedometer"></span>
            <!-- pointer value between -90 and 90deg -->
            <span id="0" class="pointer"></span>
            <!-- number value between 0 and 5000-->
            <h1 id = "number0" class="number"></h1>
        </div>
        <div id="logo">
            <span class="speedometer"></span>
            <span id="1" class="pointer"></span>
            <h1 id = "number1" class="number"> 20 </h1>
        </div>
        <div id="logo">
            <span class="speedometer"></span>
            <span id="2" class="pointer"></span>
            <h1 id = "number2" class="number"> 20 </h1>
        </div>
        <div id="logo">
            <span class="speedometer"></span>
            <span id="3" class="pointer"></span>
            <h1 id = "number3" class="number"> 20 </h1>
        </div>
        <div id="logo">
            <span class="speedometer"></span>
            <span id="4" class="pointer"></span>
            <h1 id = "number4" class="number"> 20 </h1>
        </div>
        <div id="logo">
            <span class="speedometer"></span>
            <span id="5" class="pointer"></span>
            <h1 id = "number5" class="number"> 20 </h1>
        </div>
        <div id="logo">
            <span class="speedometer"></span>
            <span id="6" class="pointer"></span>
            <h1 id = "number6" class="number"> 20 </h1>
        </div>
        <div id="logo">
            <span class="speedometer"></span>
            <span id="7" class="pointer"></span>
            <h1 id = "number7" class="number"> 20 </h1>
        </div>
        <div id="logo">
            <span class="speedometer"></span>
            <span id="8" class="pointer"></span>
            <h1 id = "number8" class="number"> 20 </h1>
        </div>
    </div>

    <div class="flex-video">
        <img class="video" src="http://192.168.1.10:8000/stream/">
    </div>

    <script>
	function map(value, low1, high1, low2, high2) {
    		return low2 + (high2 - low2) * (value - low1) / (high1 - low1);
	}
	function getData() {
            console.log('getData');
            const xmlhttp = new XMLHttpRequest();
            const url = "http://192.168.1.10:8000/sps/data";
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    const data = JSON.parse(this.responseText);
                    console.log(data);
                    for(var i = 0; i<=8; i++){
			            var deg_value = map(Math.abs(Object.values(data)[i]), 0, 500, -90, 90);
                        document.getElementById(i).style = "--value: " + deg_value + "deg";
                        document.getElementById("number"+i).innerHTML = Object.keys(data)[i] + Object.values(data)[i];
                    }
                    console.log(Object.values(data)[0]);
                    setTimeout(getData, 3 * 1000);
                }
            }
            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }
        getData();
    </script>
</body>

</html>
